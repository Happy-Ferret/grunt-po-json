<script id="strblock" type="text/po">msgid ""
msgstr ""
"Project-Id-Version: Test\n"
"POT-Creation-Date: 2014-02-20 13:04+0100\n"
"PO-Revision-Date: 2014-02-20 13:04+0100\n"
"Last-Translator: Nicky Out <nickyout@gmail.com>\n"
"Language-Team: Test team <nickyout@gmail.com>\n"
"MIME-Version: 1.0\n"
"Content-Type: text/plain; charset=UTF-8\n"
"Content-Transfer-Encoding: 8bit\n"
"X-Generator: Poedit 1.5.7\n"
"X-Poedit-KeywordsList: _;gettext;gettext_noop\n"
"X-Poedit-Basepath: .\n"
"X-Poedit-Bookmarks: -1,-1,-1,-1,-1,29,-1,-1,-1,-1\n"

# Single line
msgid "Single line id"
msgstr "A single line string"

# Multi line
msgid ""
    "Multi "
  "line "
"id"
msgstr ""
"A "
  "multi "
    "line "
      "string"

# Another Single line
 msgid "Another single line id"
 msgstr "A single line string 2"


# Commented out
#~ msgid "Commented id"
#~ msgstr "Commented str"

#, python-format, javascript-format
msgid "%d second ago"
msgid_plural "%d secondS ago"
msgstr[0] "%d second ago"
msgstr[1] "%d secondS ago"


msgid ""
 "multi "
    "line "
        "plural"
msgid_plural ""
    "multi "
        "line "
            "plurals"
msgstr[0] ""
    "multi "
        "singular"
msgstr[1] ""
    "multi "
        "plural"</script>

<script>

/**
 * Accepts the contents of a po file, and puts all translations in the target Object.
 * NB: this function was rewritten for this fork 
 *
 * @param {String} poStr the contents of a po file.
 * @returns {Object} The translations in name-value pairs.
 */
var poStrToObject = function(poStr, target)
{
	// Prepare output
	var target = target || {};
	
	// Split input in lines
	var lines = poStr.split(/[\r\n]+/g);
	
	// Next information to read:
	// 0: msgid
	// 1: comment msgstr
	// 2: regular msgstr or msgid_plural
	// 3: msgstr[0]
	// 4: msgstr[1]
	
	var next = 0;
	
	var id = "", id_plural = "", msg = "", msg_plural = "";

	// Loop on lines
	for (var i = 0; i < lines.length; i++){
	
		console.log("=====");
	
		// Ignore empty lines
		if(/^ *$/.test(lines[i])){
			continue
		}
		
		// Ignore comments ("# ...")
		if(/^ *#.*$/.test(lines[i])){
			continue
		}
		
		// Ignore contexts ("msgctxt ...")
		if(/^ *msgctxt.*$/.test(lines[i])){
			continue
		}
	
		// Switch on the next thing to read
		switch(next){
		
			// msgid
			case 0:
			
				id = "";
				
				// Empty msgid
				if(lines[i] == 'msgid ""'){
					
					// Case 1: next line is a "msgstr" (comment)
					if(/^ *msgstr/.test(lines[i+1])){
						next = 1;
					}
					
					// Case 2: the next line(s) contain a multiline msgid
					// => read id on multiple lines
					else {
					
						while(/^ *".*"$/.test(lines[i+1])){
							id += /^ *"(.*)"$/.exec(lines[i+1])[1];
							i++;
						}
						
						next = 2;
					}
				}
				
				// Not empty msgid
				// => Save it in id
				else {
					id = /msgid "(.*)"/.exec(lines[i])[1];
					next = 2;
				}
				
				console.log("id: ", id);
				console.log("next: ", next);

			break;
				
			// msgstr comment
			case 1:
				
				while(/^".*"$/.test(lines[i+1])){
					i++;
				}
				next = 0;
				console.log("next: ", next);
				
			break;
			
			// msgstr or msgid_plural
			case 2:
				
				// msgstr
				if(/^ *msgstr/.test(lines[i])){
					
					msg = "";
					
					// Multiline (if first line is empty)
					if(lines[i] == 'msgstr ""'){
						while(/^ *".*"$/.test(lines[i+1])){
							msg += /^ *"(.*)"$/.exec(lines[i+1])[1];
							i++;
						}
						next = 0;
					}
					
					// Single line
					else {
						msg = /msgstr "(.*)"/.exec(lines[i])[1];
						next = 0;
					}
					
					console.log("msg: ", msg);
					console.log("next: ", next);
					target[id] = msg;
				}
				
				// msgid_plural
				else if(/^ *msgid_plural/.test(lines[i])){
				
					id_plural = "";
				
					// Multiline (if first line is empty)
					if(lines[i] == 'msgid_plural ""'){
						while(/^ *".*"$/.test(lines[i+1])){
							id_plural += /^ *"(.*)"$/.exec(lines[i+1])[1];
							i++;
						}
						next = 3;
					}
					
					// Single line
					else {
						id_plural = /msgid_plural "(.*)"/.exec(lines[i])[1];
						next = 3;
					}
					
					console.log("id_plural: ", id_plural);
					console.log("next: ", next);
				}
			
			break;
			
			// msgstr[0]
			case 3:
			
				msg = "";
				
				// Multiline (if first line is empty)
				if(lines[i] == 'msgstr[0] ""'){
					while(/^ *".*"$/.test(lines[i+1])){
						msg += /^ *"(.*)"$/.exec(lines[i+1])[1];
						i++;
					}
					next = 4;
				}
				
				// Single line
				else {
					msg = /msgstr\[0\] "(.*)"/.exec(lines[i])[1];
					next = 4;
				}
				
				console.log("msg: ", msg);
				console.log("next: ", next);
			
			break;
			
			// msgstr[1]
			case 4:
			
				msg_plural = "";
				
				// Multiline (if first line is empty)
				if(lines[i] == 'msgstr[1] ""'){
					while(/^ *".*"$/.test(lines[i+1])){
						msg_plural += /^ *"(.*)"$/.exec(lines[i+1])[1];
						i++;
					}
					next = 0;
				}
				
				// Single line
				else {
					msg_plural = /msgstr\[1\] "(.*)"/.exec(lines[i])[1];
					next = 0;
				}
				
				target[id] = msg;
				target[id_plural] = msg_plural;
				console.log("msg: ", msg);
				console.log("next: ", next);
			
			break;
		}
	}
	
	return target;
};

var str = strblock.innerHTML;


document.write("<pre>"+JSON.stringify(poStrToObject(str), null, "  "));

</script>